version: '3'

services:
  next-app:
    container_name: frontend
    build:
      context: ./frontend
      dockerfile: prod.Dockerfile
      args:
        NEXTAUTH_SECRET: ${NEXTAUTH_SECRET}
        GOOGLE_ID: ${GOOGLE_ID}
        GOOGLE_SECRET: ${GOOGLE_SECRET}
        FACEBOOK_ID: ${FACEBOOK_ID}
        FACEBOOK_SECRET: ${FACEBOOK_SECRET}
        GITHUB_ID: ${GITHUB_ID}
        GITHUB_SECRET: ${GITHUB_SECRET}
        NEXT_PUBLIC_S3_CREDENTIAL_SECRET_ACCESS_KEY: ${NEXT_PUBLIC_S3_CREDENTIAL_SECRET_ACCESS_KEY}
        NEXT_PUBLIC_S3_CREDENTIAL_ACCESS_KEY_ID: ${NEXT_PUBLIC_S3_CREDENTIAL_ACCESS_KEY_ID}
        NEXT_PUBLIC_S3_BUCKET_NAME: ${NEXT_PUBLIC_S3_BUCKET_NAME}
        NEXT_PUBLIC_S3_IMAGE_URL: ${NEXT_PUBLIC_S3_IMAGE_URL}
    restart: always
    ports:
      - 3000:3000
    networks:
      - my_network

  # Add more containers below (nginx, postgres, etc.)

# Define a network, which allows containers to communicate
# with each other, by using their container name as a hostname
networks:
  my_network:
    external: true